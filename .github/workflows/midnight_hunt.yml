name: 'ARES V86 COMPLETE ARSENAL + UNLIMITED INSTALL'
on:
  workflow_dispatch: 

jobs:
  hunt:
    runs-on: ubuntu-latest
    timeout-minutes: 360 
    permissions:
      contents: write
      actions: write

    steps:
      - name: 'Checkout Code'
        uses: actions/checkout@v4

      - name: 'Auto-Cleanup Previous Data'
        run: |
          TARGET=$(grep -v '^#' targets.txt | tr -d '\r' | xargs | awk '{print $1}')
          echo "=== Cleaning Previous Run Data ==="
          sudo rm -rf reconftw/ 2>/dev/null || true
          sudo rm -rf *.zip ARES_*.zip FINAL_*.zip BURST_*.zip PART.* FINAL_PART_* 2>/dev/null || true
          sudo rm -rf Sent_Buffer/ .sent_bytes 2>/dev/null || true
          go clean -cache -modcache -testcache 2>/dev/null || true
          pip cache purge 2>/dev/null || true
          echo "=== Cleanup Complete ==="
          df -h /

      - name: 'System Initialization & Telegram Alert'
        run: |
          TARGET=$(grep -v '^#' targets.txt | tr -d '\r' | xargs | awk '{print $1}')
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
            -d "chat_id=${{ secrets.TELEGRAM_CHAT_ID }}" \
            -d "text=ðŸš€ [ARES V86] COMPLETE 94+ TOOL ARSENAL%0Aâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”%0AðŸŽ¯ Target: $TARGET%0Aâš¡ Status: Initializing system...%0AðŸ§¹ Previous data: CLEARED%0AðŸ”§ All tools enabled (except API-only)%0Aâ±ï¸ Estimated: 5-6 hours for deep scan"
          sudo rm -rf /usr/share/dotnet /usr/local/lib/android /opt/ghc /usr/local/go /opt/az /opt/hostedtoolcache
          sudo rm -rf /usr/share/swift /usr/local/.ghcup /usr/lib/jvm
          sudo apt-get clean
          sudo apt-get autoclean
          sudo apt-get autoremove -y
          df -h /

      - name: 'Force Go Installation'
        run: |
          wget -q https://go.dev/dl/go1.22.0.linux-amd64.tar.gz
          sudo tar -C /usr/local -xzf go1.22.0.linux-amd64.tar.gz
          rm go1.22.0.linux-amd64.tar.gz
          echo "/usr/local/go/bin" >> $GITHUB_PATH
          echo "/home/runner/go/bin" >> $GITHUB_PATH
          echo "/home/runner/.local/bin" >> $GITHUB_PATH
          echo "GOROOT=/usr/local/go" >> $GITHUB_ENV
          echo "GOPATH=/home/runner/go" >> $GITHUB_ENV

      - name: 'Install Dependencies'
        run: |
          export DEBIAN_FRONTEND=noninteractive
          sudo apt-get update -qq
          sudo apt-get install -y -qq libpcap-dev libcurl4-openssl-dev libxml2-dev libxslt1-dev \
            python3-pip python3-dev python3-venv zip pipx bc rsync jq chromium-browser \
            build-essential ruby ruby-dev git wget curl unzip

      - name: 'Install reconFTW Without Testing'
        run: |
          TARGET=$(grep -v '^#' targets.txt | tr -d '\r' | xargs | awk '{print $1}')
          export PATH="/usr/local/go/bin:/home/runner/go/bin:/home/runner/.local/bin:$PATH"
          git clone --depth 1 https://github.com/six2dez/reconftw
          cd reconftw/
          
          # Remove testing from installer
          sed -i '/printf "${bgreen}#######%0A/,/printf.*test scan/d' install.sh
          sed -i '/subfinder.*-d.*\.y/d' install.sh
          sed -i '/assetfinder.*\.y/d' install.sh
          sed -i '/amass.*enum.*-d.*\.y/d' install.sh
          sed -i '/nuclei.*-u.*http/d' install.sh
          sed -i '/httpx.*-u.*http/d' install.sh
          sed -i '/katana.*-u.*http/d' install.sh
          sed -i '/gau.*\.y/d' install.sh
          
          pipx ensurepath
          export DEBIAN_FRONTEND=noninteractive
          
          # âš¡ REMOVED TIMEOUT: This will run until all tools are installed
          yes | ./install.sh > /dev/null 2>&1 || echo "Install completed with warnings"
          
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
            -d "chat_id=${{ secrets.TELEGRAM_CHAT_ID }}" \
            -d "text=âœ… INSTALLATION COMPLETE%0Aâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”%0AðŸŽ¯ Target: $TARGET%0AðŸ› ï¸ 94+ tools installed%0AðŸ”¥ Ready for full reconnaissance..."

      - name: 'Configure All Tools'
        env:
          GIT_PAT: ${{ secrets.GIT_PAT }}
        run: |
          cd reconftw/
          # (Configuration sed commands remain exactly as you had them)
          sed -i 's/DEEP=false/DEEP=true/g' reconftw.cfg
          sed -i 's/MULTITHREADING=false/MULTITHREADING=true/g' reconftw.cfg
          sed -i 's/SUBCRT=false/SUBCRT=true/g' reconftw.cfg
          sed -i 's/SUBANALYTICS=false/SUBANALYTICS=true/g' reconftw.cfg
          sed -i 's/SUBBRUTE=false/SUBBRUTE=true/g' reconftw.cfg
          sed -i 's/SUBSCRAPING=false/SUBSCRAPING=true/g' reconftw.cfg
          sed -i 's/SUBPERMUTE=false/SUBPERMUTE=true/g' reconftw.cfg
          sed -i 's/SUBREGEX=false/SUBREGEX=true/g' reconftw.cfg
          sed -i 's/ZONETRANSFER=false/ZONETRANSFER=true/g' reconftw.cfg
          sed -i 's/PASSIVE=false/PASSIVE=true/g' reconftw.cfg
          sed -i 's/WAYBACK=false/WAYBACK=true/g' reconftw.cfg
          sed -i 's/GAUTH=false/GAUTH=true/g' reconftw.cfg
          sed -i 's/GITHUB=false/GITHUB=true/g' reconftw.cfg
          sed -i 's/METADATA=false/METADATA=true/g' reconftw.cfg
          sed -i 's/WEBPROBESIMPLE=true/WEBPROBESIMPLE=false/g' reconftw.cfg
          sed -i 's/WEBPROBEFULL=true/WEBPROBEFULL=false/g' reconftw.cfg
          sed -i 's/SCREENSHOT=false/SCREENSHOT=true/g' reconftw.cfg
          sed -i 's/WEBSCREENSHOT=false/WEBSCREENSHOT=true/g' reconftw.cfg
          sed -i 's/PORTSCAN_ACTIVE=false/PORTSCAN_ACTIVE=true/g' reconftw.cfg
          sed -i 's/PORTSCAN_PASSIVE=false/PORTSCAN_PASSIVE=true/g' reconftw.cfg
          sed -i 's/NUCLEICHECK=false/NUCLEICHECK=true/g' reconftw.cfg
          sed -i 's/NUCLEI_SEVERITY=info/NUCLEI_SEVERITY=info/g' reconftw.cfg
          sed -i 's/VULNS_GENERAL=false/VULNS_GENERAL=true/g' reconftw.cfg
          sed -i 's/XSS=false/XSS=true/g' reconftw.cfg
          sed -i 's/CORS=false/CORS=true/g' reconftw.cfg
          sed -i 's/TEST_SSL=false/TEST_SSL=true/g' reconftw.cfg
          sed -i 's/OPEN_REDIRECT=false/OPEN_REDIRECT=true/g' reconftw.cfg
          sed -i 's/SSRF_CHECKS=false/SSRF_CHECKS=true/g' reconftw.cfg
          sed -i 's/CRLF_CHECK=false/CRLF_CHECK=true/g' reconftw.cfg
          sed -i 's/LFI=false/LFI=true/g' reconftw.cfg
          sed -i 's/SSTI=false/SSTI=true/g' reconftw.cfg
          sed -i 's/SQLI=false/SQLI=true/g' reconftw.cfg
          sed -i 's/SMUGGLING=false/SMUGGLING=true/g' reconftw.cfg
          sed -i 's/WEBCACHE=false/WEBCACHE=true/g' reconftw.cfg
          sed -i 's/FUZZ=false/FUZZ=true/g' reconftw.cfg
          sed -i 's/PERMUTATIONS_FUZZ=false/PERMUTATIONS_FUZZ=true/g' reconftw.cfg
          sed -i 's/FUZZPARAMS=false/FUZZPARAMS=true/g' reconftw.cfg
          sed -i 's/CMS_SCANNER=false/CMS_SCANNER=true/g' reconftw.cfg
          sed -i 's/WORDLIST_GEN=false/WORDLIST_GEN=true/g' reconftw.cfg
          sed -i 's/ROBOTSWORDLIST=false/ROBOTSWORDLIST=true/g' reconftw.cfg
          sed -i 's/S3BUCKETS=false/S3BUCKETS=true/g' reconftw.cfg
          sed -i 's/CLOUD_IP=false/CLOUD_IP=true/g' reconftw.cfg
          sed -i 's/OSINT=false/OSINT=true/g' reconftw.cfg
          sed -i 's/EMAILS=false/EMAILS=true/g' reconftw.cfg
          sed -i 's/DOMAIN_INFO=false/DOMAIN_INFO=true/g' reconftw.cfg
          sed -i 's/GOSPIDER=false/GOSPIDER=true/g' reconftw.cfg
          sed -i 's/URLGF=false/URLGF=true/g' reconftw.cfg
          sed -i 's/JSCHECKS=false/JSCHECKS=true/g' reconftw.cfg
          sed -i 's/WORDLIST=false/WORDLIST=true/g' reconftw.cfg
          sed -i 's/GITDORKER=false/GITDORKER=true/g' reconftw.cfg
          sed -i 's/URLCHECKS=false/URLCHECKS=true/g' reconftw.cfg
          sed -i 's/TAKEOVER=false/TAKEOVER=true/g' reconftw.cfg
          sed -i 's/DNSTAKEOVER=false/DNSTAKEOVER=true/g' reconftw.cfg
          sed -i 's/HEADLESS=false/HEADLESS=true/g' reconftw.cfg
          sed -i 's/IPINFO=false/IPINFO=true/g' reconftw.cfg
          sed -i 's/ANALYTICSID=false/ANALYTICSID=true/g' reconftw.cfg
          sed -i 's/VIRUSTOTAL=true/VIRUSTOTAL=false/g' reconftw.cfg
          sed -i 's/SHODAN=true/SHODAN=false/g' reconftw.cfg
          sed -i 's/SECURITYTRAILS=true/SECURITYTRAILS=false/g' reconftw.cfg
          sed -i 's/ZOOMEYE=true/ZOOMEYE=false/g' reconftw.cfg
          mkdir -p /home/runner/Tools
          echo "$GIT_PAT" > /home/runner/Tools/.github_tokens

      - name: 'System Binary Weld'
        run: |
          sudo ln -sf /usr/local/go/bin/* /usr/bin/ 2>/dev/null || true
          sudo ln -sf /home/runner/go/bin/* /usr/bin/ 2>/dev/null || true
          sudo ln -sf /home/runner/.local/bin/* /usr/bin/ 2>/dev/null || true
          sudo find /home/runner/Tools -type f -executable -exec ln -sf {} /usr/bin/ \; 2>/dev/null || true
          mkdir -p /home/runner/.cache /home/runner/.config
          sudo ln -sf /home/runner/.cache /.cache
          sudo ln -sf /home/runner/.config /.config
          sudo chmod -R 755 /home/runner

      - name: 'Execute Full Reconnaissance'
        timeout-minutes: 320
        run: |
          TARGET=$(grep -v '^#' targets.txt | tr -d '\r' | xargs | awk '{print $1}')
          export PATH="/usr/local/go/bin:/home/runner/go/bin:/home/runner/.local/bin:/usr/bin:/bin:$PATH"
          export TELEGRAM_TOKEN="${{ secrets.TELEGRAM_TOKEN }}"
          export TELEGRAM_CHAT_ID="${{ secrets.TELEGRAM_CHAT_ID }}"
          
          RECON_DIR="${GITHUB_WORKSPACE}/reconftw/Recon/${TARGET}"
          SENT_MARKER="${GITHUB_WORKSPACE}/.sent_bytes"
          echo "0" > "$SENT_MARKER"
          
          (
            while true; do
              sleep 120
              if [ -d "$RECON_DIR" ]; then
                CURRENT_SIZE=$(du -sb "$RECON_DIR" 2>/dev/null | awk '{print $1}')
                SENT_SIZE=$(cat "$SENT_MARKER")
                NEW_DATA=$((CURRENT_SIZE - SENT_SIZE))
                if [ "$NEW_DATA" -ge 47185920 ]; then
                  TIMESTAMP=$(date +%Y%m%d_%H%M%S)
                  sudo find "$RECON_DIR" -type f -newer "$SENT_MARKER" -print0 2>/dev/null | sudo xargs -0 zip -q "BURST_${TIMESTAMP}.zip" 2>/dev/null || true
                  if [ -f "BURST_${TIMESTAMP}.zip" ]; then
                    curl -F chat_id="${TELEGRAM_CHAT_ID}" -F document=@"BURST_${TIMESTAMP}.zip" -F caption="ðŸ“¦ AUTO-BURST: New findings for ${TARGET}" "https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendDocument"
                    echo "$CURRENT_SIZE" > "$SENT_MARKER"
                    rm "BURST_${TIMESTAMP}.zip"
                  fi
                fi
              fi
            done
          ) &
          SENDER_PID=$!
          
          cd reconftw/
          sudo -E PATH="$PATH" TELEGRAM_TOKEN="${TELEGRAM_TOKEN}" TELEGRAM_CHAT_ID="${TELEGRAM_CHAT_ID}" ./reconftw.sh -d "${TARGET}" -r -a -s --deep
          kill $SENDER_PID 2>/dev/null || true

      - name: 'Final Report Delivery & Cleanup'
        if: always()
        run: |
          TARGET=$(grep -v '^#' targets.txt | tr -d '\r' | xargs | awk '{print $1}')
          RECON_DIR="reconftw/Recon/${TARGET}"
          if [ -d "$RECON_DIR" ] && [ "$(ls -A ${RECON_DIR} 2>/dev/null)" ]; then
            sudo zip -r "FINAL_REPORT.zip" "$RECON_DIR" 2>/dev/null || true
            if [ -f "FINAL_REPORT.zip" ]; then
              split -b 45M "FINAL_REPORT.zip" "FINAL_PART_"
              for part in FINAL_PART_*; do
                curl -F chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" -F document=@"${part}" "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendDocument"
                rm "$part"
              done
            fi
          fi
          sudo rm -rf reconftw/ /home/runner/Tools/* /tmp/* 2>/dev/null || true
