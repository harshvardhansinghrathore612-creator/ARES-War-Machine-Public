name: ARES Scanner

on:
  workflow_dispatch:
    inputs:
      scan_type:
        description: Tools to run
        required: true
        default: all
      target:
        description: Target domain
        required: true

jobs:
  scan:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Show inputs
        run: |
          echo "Scan type: ${{ github.event.inputs.scan_type }}"
          echo "Target: ${{ github.event.inputs.target }}"
      
      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.22'
      
      - name: Install tools
        run: |
          go install github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
          go install github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
      
      - name: Run scan
        run: |
          TARGET="${{ github.event.inputs.target }}"
          SCAN="${{ github.event.inputs.scan_type }}"
          mkdir -p output
          
          echo "Starting scan on $TARGET with $SCAN"
          
          if [[ "$SCAN" == *"subfinder"* ]] || [[ "$SCAN" == "all" ]]; then
            echo "Running subfinder..."
            subfinder -d "$TARGET" -silent -o output/subdomains.txt || true
          fi
          
          if [[ "$SCAN" == *"httpx"* ]] || [[ "$SCAN" == "all" ]]; then
            echo "Running httpx..."
            if [ -f output/subdomains.txt ]; then
              httpx -l output/subdomains.txt -silent -o output/live.txt || true
            else
              echo "$TARGET" | httpx -silent -o output/live.txt || true
            fi
          fi
          
          if [[ "$SCAN" == *"nuclei"* ]] || [[ "$SCAN" == "all" ]]; then
            echo "Running nuclei..."
            if [ -f output/live.txt ]; then
              nuclei -l output/live.txt -severity medium,high,critical -o output/nuclei.txt || true
            fi
          fi
          
          echo "Scan complete!"
          ls -la output/
      
      - name: Upload results
        uses: actions/upload-artifact@v4
        with:
          name: scan-results
          path: output/